<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>BeeBee AI - ê²°ì œ ì„±ê³µ</title>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #0c0c0d;
        color: #f5f5f7;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
      }
      .card {
        max-width: 440px;
        width: 100%;
        background: #1c1c1e;
        padding: 24px 20px;
        border-radius: 20px;
        box-shadow: 0 14px 40px rgba(0, 0, 0, 0.5);
        text-align: center;
      }
      h1 {
        font-size: 22px;
        margin-bottom: 8px;
      }
      p {
        margin: 4px 0;
        color: #a1a1a6;
      }
      .highlight {
        font-size: 18px;
        margin: 12px 0;
      }
      .ok {
        color: #30d158;
      }
      .btn {
        margin-top: 18px;
        padding: 10px 18px;
        border-radius: 999px;
        border: none;
        background: #ffd60a;
        color: #111;
        cursor: pointer;
        font-size: 14px;
      }
    </style>
    <link rel="icon" type="image/png" sizes="32x21" href="/image/tabLogo.png" />
  </head>
  <body>
    <div class="card">
      <h1>ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ‰</h1>
      <p class="highlight ok" id="status-text">Toss ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘...</p>
      <p id="detail"></p>
      <p id="error" style="color: #ff453a; margin-top: 10px"></p>
      <button class="btn" onclick="location.href='/'">í™ˆìœ¼ë¡œ ì´ë™</button>
    </div>

    <script>
      const API_BASE = ""; // ë°±ì—”ë“œ ì£¼ì†Œ (ê°™ì€ ë„ë©”ì¸ì´ë©´ "")

      function getQuery() {
        const params = new URLSearchParams(location.search);
        return {
          paymentKey: params.get("paymentKey"),
          orderId: params.get("orderId"),
          amount: params.get("amount"),
        };
      }

      async function confirm() {
        const { paymentKey, orderId, amount } = getQuery();
        const statusText = document.getElementById("status-text");
        const detailEl = document.getElementById("detail");
        const errorEl = document.getElementById("error");

        if (!paymentKey || !orderId || !amount) {
          statusText.textContent = "í•„ìˆ˜ ì •ë³´ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.";
          errorEl.textContent =
            "paymentKey, orderId, amountê°€ URLì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
          return;
        }

        statusText.textContent = "ì„œë²„ì—ì„œ ê²°ì œ ìŠ¹ì¸ í™•ì¸ ì¤‘...";

        try {
          const res = await fetch(API_BASE + "/api/payments/confirm", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            credentials: "include",
            body: JSON.stringify({ paymentKey, orderId, amount }),
          });

          const data = await res.json();

          if (!res.ok || !data.ok) {
            throw new Error(data.error || "ê²°ì œ ìŠ¹ì¸ ì‹¤íŒ¨");
          }

          statusText.textContent = "ê²°ì œê°€ ì •ìƒì ìœ¼ë¡œ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.";
          detailEl.textContent = `ì£¼ë¬¸ë²ˆí˜¸: ${
            data.orderId
          } Â· ê²°ì œê¸ˆì•¡: ${data.amount.toLocaleString()}ì›`;
        } catch (err) {
          console.error(err);
          statusText.textContent = "ê²°ì œ ìŠ¹ì¸ ê³¼ì •ì—ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
          errorEl.textContent =
            err.message || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        }
      }

      confirm();
    </script>
  </body>
</html>
